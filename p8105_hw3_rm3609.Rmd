---
title: "p8105_hw3_rm3609"
author: "Runqi Ma"
date: "2018/10/14"
output: html_document
---


```{r}
library(tidyverse)
library(patchwork)
knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_bw() + theme(legend.position = "bottom"))
```

#Problem 1 
###First, do some data cleaning:
format the data to use appropriate variable names;
focus on the “Overall Health” topic
include only responses from “Excellent” to “Poor”
organize responses as a factor taking levels ordered from “Excellent” to “Poor”

```{r}
devtools::install_github("p8105/p8105.datasets")
library(p8105.datasets)
data(brfss_smart2010)

brfss_smart2010 = janitor::clean_names(brfss_smart2010) %>% 
  rename(resp_id = respid, state = locationabbr, location = locationdesc) %>% 
  filter(topic == "Overall Health", 
         response %in% c("Excellent","Very good","Good","Fair","Poor"))


mutate(brfss_smart2010,response = as.factor(response)) %>% 
  mutate(response = forcats::fct_relevel(response, c("Excellent", "Very good", "Good", "Fair", "Poor")))

```


###In 2002, which states were observed at 7 locations?
```{r}
brfss_smart2010 %>% 
  filter(year == 2002) %>% 
  group_by(state) %>% 
  summarize(n = n_distinct(location)) %>% 
  filter(n == 7)
  
```

###Make a “spaghetti plot” that shows the number of locations in each state from 2002 to 2010.
```{r}
brfss_smart2010 %>% 
  filter(year %in% (2002:2010)) %>% 
  group_by(state, year) %>% 
  summarize(n = n_distinct(location)) %>% 
  ggplot(aes(x = year, y = n, color = state), alpha = .5) +
  geom_line() +
   labs(
    title = "Location Number in Each State",
    x = "year",
    y = "number of locations"
  ) + 
  theme_bw()
  
```

